package windowsListener;

import java.util.LinkedList;
import java.util.Queue;
import net.contentobjects.jnotify.JNotifyListener;
import records.FileRecord;

public class FolderListener implements JNotifyListener {

    //public Queue<String> queue = new LinkedList<>();
    public Queue<FileRecord> fileRecordsQueue = new LinkedList<>();
    public String msg = "";
    public boolean locker = true;

    @Override
    public void fileRenamed(int wd, String rootPath, String oldName,
            String newName) {
        if (TypeChecker.checkType(rootPath, oldName) && TypeChecker.checkType(rootPath, newName)) {

            print("renamed " + rootPath + " : " + oldName + " -> " + newName);
            msg = "renamed:#" + oldName + "->" + newName;
            fileRecordsQueue.add(FileRecord.createFileRecord(rootPath, oldName, "renamed", newName));
        }
    }

    @Override
    public void fileDeleted(int wd, String rootPath, String name) {
        if (TypeChecker.checkType(rootPath, name)) {

            print("deleted " + rootPath + " : " + name);
            msg = "deleted:#" + name;
            //fileRecordsQueue.add(FileRecord.createFileRecord(rootPath, name, "deleted", null));
        }
    }

    @Override
    public void fileModified(int wd, String rootPath, String name) {
        if (TypeChecker.checkType(rootPath, name)) {

            print("modified " + rootPath + " : " + name);
            msg = "modified:#" + name;
            locker = false;
            FileRecord fc = FileRecord.createFileRecord(rootPath, name, "modified", null);
            //System.out.println(fc + "\n" + fileRecordsQueue.peek() + "\n" + fc.equals(fileRecordsQueue.peek()));
            if (!fc.equals(fileRecordsQueue.peek())) {
                fileRecordsQueue.add(fc);
            }
            locker = true;
        }
    }

    @Override
    public void fileCreated(int wd, String rootPath, String name) {
        if (TypeChecker.checkType(rootPath, name)) {

            print("created " + rootPath + " : " + name);
            msg = "created:#" + name;

            locker = false;
            FileRecord fc = FileRecord.createFileRecord(rootPath, name, "modified", null);
            //System.out.println(fc + "\n" + fileRecordsQueue.peek() + "\n" + fc.equals(fileRecordsQueue.peek()));
            if (!fc.equals(fileRecordsQueue.peek())) {
                fileRecordsQueue.add(fc);
            }
            locker = true;
        }
    }

    void print(String msg) {
        System.out.println(msg);
    }
}
